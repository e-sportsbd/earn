<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Watch Ad</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Telegram WebApp -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
body{
  background:#0b0f1a;
  color:#fff;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.app{
  width:100%;
  max-width:420px;
  height:100%;
  background:#12172a;
  border-radius:18px;
  border:1px solid #2b335a;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.header{
  background:#feca2a;
  color:#000;
  text-align:center;
  padding:10px;
  font-weight:bold;
}
iframe{
  flex:1;
  border:none;
  background:#000;
}
.controls{
  padding:12px;
  text-align:center;
}
#timer{
  font-size:26px;
  color:#00ff9d;
  margin-bottom:8px;
}
#progress{
  font-size:14px;
  margin-bottom:8px;
}
button{
  width:100%;
  padding:14px;
  font-size:16px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#6a5cff,#2ec7ff);
  color:#fff;
}
button:disabled{opacity:.6}
.note{
  font-size:13px;
  opacity:.7;
  margin-top:6px;
}
</style>
</head>

<body>

<div class="app">
  <div class="header">üì∫ Sponsored Advertisement</div>

  <iframe id="adFrame"></iframe>

  <div class="controls">
    <div id="progress">Loading...</div>
    <div id="timer">0</div>
    <button id="doneBtn" disabled>‚úÖ Done</button>
    <div class="note">‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡¶≤‡ßá reward ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá ‡¶®‡¶æ</div>
  </div>
</div>

<!-- ================= SCRIPT ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
            authDomain: "noreply@post-c7e41.firebaseapp.com",
            databaseURL: "https://post-c7e41-default-rtdb.firebaseio.com",
            projectId: "post-c7e41",
            messagingSenderId: "758133068153",
            appId: "1:758133068153:web:28ef27e45d8037e0d49fa8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== TELEGRAM ===== */
const tg = Telegram.WebApp;
tg.ready();

const user = tg.initDataUnsafe.user;
if(!user){
  alert("Please open from Telegram");
  tg.close();
}
const uid = String(user.id);

/* ===== ADMIN CONTROL ===== */
const ADS = [
  "https://t.me/adsgram_ai?start=AD1",
  "https://t.me/adsgram_ai?start=AD2",
  "https://t.me/adsgram_ai?start=AD3"
];

const SECONDS_PER_AD = 15;
const REWARD_PER_AD = 30;
const TOTAL_REWARD = ADS.length * REWARD_PER_AD;

/* ===== ELEMENTS ===== */
const iframe = document.getElementById("adFrame");
const timerEl = document.getElementById("timer");
const progressEl = document.getElementById("progress");
const doneBtn = document.getElementById("doneBtn");

/* ===== STATE ===== */
let index = 0;
let seconds = SECONDS_PER_AD;
let interval;

/* ===== LOAD AD ===== */
function loadAd(){
  if(index >= ADS.length){
    progressEl.innerText = "‚úÖ All Ads Completed";
    timerEl.innerText = "Done";
    doneBtn.disabled = false;
    return;
  }

  iframe.src = ADS[index];
  progressEl.innerText = `Ad ${index + 1} of ${ADS.length}`;
  seconds = SECONDS_PER_AD;
  timerEl.innerText = seconds;

  interval = setInterval(()=>{
    seconds--;
    timerEl.innerText = seconds;

    if(seconds <= 0){
      clearInterval(interval);
      index++;
      loadAd();
    }
  },1000);
}

/* ===== DONE CLICK ===== */
doneBtn.onclick = async () => {
  doneBtn.disabled = true;
  try{
    await updateDoc(doc(db,"users",uid),{
      balance: increment(TOTAL_REWARD),
      dailyDone: increment(1),
      hourlyDone: increment(1),
      lastAdTime: Date.now()
    });

    tg.showAlert(`üéâ ${TOTAL_REWARD} SHIB added`);
    tg.openLink("https://yourdomain.com/index.html");

  }catch(e){
    alert("‚ùå Reward failed");
    tg.close();
  }
};

/* ===== ANTI CHEAT ===== */
document.addEventListener("visibilitychange",()=>{
  if(document.hidden){
    alert("‚ö†Ô∏è Page leave ‡¶ï‡¶∞‡¶≤‡ßá reward ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤");
    tg.close();
  }
});

/* ===== START ===== */
loadAd();
</script>

</body>
</html>